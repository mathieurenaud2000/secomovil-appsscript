<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, shrink-to-fit=no">
  <title>SecoMobil – Configuración del sistema</title>
  <style>
    :root{
      --fix: 1;
      --gap: 12px;
      --radius: 40px;
      --font-label: 12px;
      --font-small: 14px;
      --font-body: 15px;
      --btn-fs: 16px;
      --btn-ph: 14px;
      --btn-pw: 18px;
      --btn-minh: 48px;
      --black: #000;
      --white: #fff;
      --gray10: rgba(0,0,0,0.10);
      --gray20: rgba(0,0,0,0.20);
      --gray25: rgba(0,0,0,0.25);
    }

    html, body{
      margin:0; padding:0;
      width:100%; max-width:100%;
      overflow-x:hidden; box-sizing:border-box;
      background:#fff;
      font-family: Roboto, system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    }
    *, *::before, *::after{ box-sizing:inherit; }
    *:focus{ outline:none!important; box-shadow:none!important; }

    .wrapper{ padding: 0 50px; }

    /* ===== ENTÊTE ===== */
    .header{ display:block; margin: calc(var(--gap) * var(--fix)) 0; }
    .header-logo{ display:block; width:100%; line-height:0; margin:0; }
    .header-img{
      display:block; width:100%; height:auto;
      object-fit:contain; object-position:left center;
      margin:0 8px 15px 0;
      padding-bottom:30px;
    }

    .sep-black{ height:0; border-top: 5px solid var(--black); }

    .header-grid{
      display:grid; grid-template-columns: 1fr;
      align-items:end;
      gap: calc(8px * var(--fix));
      padding: calc(12px * var(--fix)) 0;
    }
    .header-title{
      text-transform: uppercase; font-weight: 900;
      font-size: calc(21px * var(--fix));
      line-height: calc(20px * var(--fix));
    }
    .header-title span{ display:block; }

    /* ===== CONTENU ===== */
    .stack{
      display:flex;
      flex-direction:column;
      gap: calc(var(--gap) * var(--fix));
    }

    .txt-mini{
      font-size: calc(var(--font-label) * var(--fix));
      color:#111;
    }
    .txt-small{
      font-size: calc(var(--font-small) * var(--fix));
      color:#111;
    }

    /* ===== DROPDOWN ===== */
    .dropdown{
      position:relative; width:100%;
      font-size: calc(var(--font-body) * var(--fix));
    }
    .dropdown[data-variant="boxed"] .dd-button{
      border: 5px solid var(--black);
      border-radius: var(--radius);
      background:#fff; color:#000;
      padding: calc(10px * var(--fix)) calc(36px * var(--fix)) calc(10px * var(--fix)) calc(10px * var(--fix));
    }

    .dd-button{
      width:100%; text-align:left; position:relative; cursor:pointer;
      line-height:1.3; font-size: inherit;
    }
    .dd-button[data-placeholder="true"] .dd-label{ color: var(--gray25); }
    .dd-label{ display:block; padding-right: calc(18px * var(--fix)); }
    .dd-caret{
      position:absolute; right: calc(16px * var(--fix)); top:50%; transform: translateY(-50%);
      width: 0; height: 0; pointer-events:none;
      border-left: calc(6px * var(--fix)) solid transparent;
      border-right: calc(6px * var(--fix)) solid transparent;
      border-top: calc(6px * var(--fix)) solid #000;
    }

    /* OVERLAY LISTE */
    .dd-overlay{
      position: fixed; inset:0; background:#fff; display:none; z-index:1000;
      overflow:auto;
    }
    .dd-overlay[data-open="true"]{ display:block; }
    .dd-overlay-inner{ max-width:100%; padding-top:0; }
    .dd-overlay-list{
      list-style:none; margin:0; padding:0;
      font-size: calc(var(--font-body) * var(--fix));
    }
    .dd-overlay-option{
      padding: calc(12px * var(--fix)) calc(10px * var(--fix));
      border-bottom: 2px solid var(--gray20);
      line-height:1.25; cursor:pointer;
    }
    .dd-overlay-option.placeholder{ color: var(--gray25); }

    /* ===== CHECKBOX ===== */
    .checkbox-row{
      display:flex;
      align-items:center;
      gap: calc(8px * var(--fix));
    }
    .checkbox-row input[type="checkbox"]{
      width: calc(18px * var(--fix));
      height: calc(18px * var(--fix));
      accent-color:#000;
    }

    /* ===== BOUTONS ===== */
    .btn{
      display:block; width:100%;
      text-transform:uppercase; font-weight:700;
      font-size: calc(var(--btn-fs) * var(--fix));
      padding: calc(var(--btn-ph) * var(--fix)) calc(var(--btn-pw) * var(--fix));
      min-height: calc(var(--btn-minh) * var(--fix));
      border-radius: var(--radius);
      border: 5px solid transparent; cursor:pointer;
      transition: filter .15s ease, background .15s ease;
    }
    .btn-noir{
      background:#000; color:#fff; border-color:#000;
      box-shadow:0 20px 40px rgba(0,0,0,0.40);
    }
    .btn-blanc{
      background:#fff; color:#000; border-color: var(--gray20);
    }
    .btn-blanc:active{
      color: rgba(0,0,0,0.5);
    }
    .btn-desactive{
      background: var(--gray10); color:#fff;
      border:0;
      box-shadow:none;
      cursor:default;
    }
  </style>
</head>
<body>
  <div class="wrapper">

    <!-- ENTÊTE -->
    <header class="header">
      <div class="header-logo">
        <img class="header-img" id="headerImg"
             src="https://lh3.googleusercontent.com/d/15N5N0TgMBTxmn2v-sKsG53mEAKaxXYtA"
             alt="Logo SecoMobil">
      </div>

      <div class="sep-black"></div>

      <div class="header-grid">
        <div class="header-title">
          <span>CONFIGURACION</span>
          <span>DEL SISTEMA</span>
        </div>
      </div>

      <div class="sep-black"></div>
    </header>

    <div class="stack">

      <div class="txt-mini">MENU DEL 6/11/2025</div>

      <!-- MENU DU JOUR -->
      <div class="dropdown" data-variant="boxed">
        <button type="button" class="dd-button">
          <span class="dd-label">Pollo a la plancha</span><span class="dd-caret"></span>
        </button>
        <script type="application/json" class="dd-data">
          ["Pollo a la plancha","Seco de pollo","Seco de carne","Pescado frito","Arroz con menestra y carne"]
        </script>
      </div>

      <!-- ESPACE AJOUTÉ -->
      <div style="height: calc(var(--gap) * var(--fix));"></div>

      <!-- CHECKBOX -->
      <label class="checkbox-row">
        <input type="checkbox" id="chkConfirm">
        <span class="txt-small">Confirmar los datos</span>
      </label>

      <!-- BOUTONS -->
      <button class="btn btn-desactive" id="btnConfigurar" disabled>CONFIGURAR</button>
      <button class="btn btn-blanc" id="btnVolverInicio">VOLVER AL INICIO</button>

      <div style="height:0;"></div>

    </div>
  </div>

  <!-- OVERLAY DROPDOWNS -->
  <div class="dd-overlay" id="ddOverlay">
    <div class="dd-overlay-inner">
      <ul class="dd-overlay-list" id="ddOverlayList"></ul>
    </div>
  </div>

  <script>
    function getWebAppBaseUrl(){
      var base = '';
      if (typeof window !== 'undefined'){
        base = window.webAppUrl || window.SECO_WEBAPP_BASE_URL || '';
      }
      if (!base){
        var path = window.location.pathname || '';
        var origin = window.location.origin || '';
        base = origin + path;
      }
      return base;
    }

    function buildWebAppUrl(pageName){
      var base = getWebAppBaseUrl();

      var params = new URLSearchParams();
      params.set('page', pageName);

      return `${base}?${params.toString()}`;
    }

    function isSidebarContext(){
      var hasHostClose = (typeof google !== 'undefined'
        && google.script
        && google.script.host
        && typeof google.script.host.close === 'function');

      return hasHostClose && window.top !== window.self;
    }

    function openInBrowser(pageName){
      var targetUrl = buildWebAppUrl(pageName);

      if (isSidebarContext()){
        window.open(targetUrl, '_blank');
        if (google && google.script && google.script.host && typeof google.script.host.close === 'function'){
          google.script.host.close();
        }
        return;
      }

      var navTarget = window.top && window.top.location ? window.top.location : window.location;
      navTarget.href = targetUrl;
    }

    function applyScaleFix(){
      var cssW = window.innerWidth;
      var screenW = Math.min(window.screen.width, window.screen.height);
      if (cssW >= 960 && cssW <= 1024) {
        var fix = (980 / screenW) * 1.5;
        document.documentElement.style.setProperty('--fix', fix.toFixed(3));
      } else {
        document.documentElement.style.setProperty('--fix','1');
      }
    }

    function sizeHeaderImage(){
      var img = document.getElementById('headerImg');
      var wrapper = document.querySelector('.wrapper');
      if (!img || !wrapper) return;
      var w = Math.floor(wrapper.clientWidth);
      img.style.width = w + 'px';
      img.style.maxWidth = '100%';
    }

    /* DROPDOWNS */
    var overlay = document.getElementById('ddOverlay');
    var overlayList = document.getElementById('ddOverlayList');
    var currentDropdown = null;

    function openOverlay(drop){
      currentDropdown = drop;
      overlayList.innerHTML = "";

      var label = drop.querySelector('.dd-label');
      var data = JSON.parse(drop.querySelector('.dd-data').textContent);

      var ph = label.textContent.trim();
      var liPh = document.createElement('li');
      liPh.className = 'dd-overlay-option placeholder';
      liPh.textContent = ph;
      liPh.onclick = ()=> closeOverlay();
      overlayList.appendChild(liPh);

      data.forEach(t=>{
        var li = document.createElement('li');
        li.className = 'dd-overlay-option';
        li.textContent = t;
        li.onclick = ()=>{
          label.textContent = t;
          closeOverlay();
        };
        overlayList.appendChild(li);
      });

      overlay.setAttribute('data-open','true');
      document.body.style.overflow='hidden';
    }

    function closeOverlay(){
      overlay.setAttribute('data-open','false');
      document.body.style.overflow='';
      currentDropdown=null;
    }

    function initDropdowns(){
      document.querySelectorAll('.dropdown').forEach(dd=>{
        dd.querySelector('.dd-button').onclick = ()=> openOverlay(dd);
      });
      overlay.onclick = e=>{ if(e.target===overlay) closeOverlay(); };
    }

    /* CHECKBOX LOGIC */
    function setupConfirmToggle(){
      var chk=document.getElementById('chkConfirm');
      var btn=document.getElementById('btnConfigurar');
      function sync(){
        if(chk.checked){
          btn.disabled=false;
          btn.classList.remove('btn-desactive');
          btn.classList.add('btn-noir');
        } else{
          btn.disabled=true;
          btn.classList.remove('btn-noir');
          btn.classList.add('btn-desactive');
        }
      }
      chk.onchange=sync;
      sync();
    }

    function init(){
      applyScaleFix();
      sizeHeaderImage();
      initDropdowns();
      setupConfirmToggle();

      var btnVolver = document.getElementById('btnVolverInicio');
      if (btnVolver){
        btnVolver.addEventListener('click', function(){
          openInBrowser('inicio');
        });
      }
    }

    document.readyState==="loading"
      ? document.addEventListener('DOMContentLoaded',init)
      : init();

    window.onresize=()=>{
      applyScaleFix();
      sizeHeaderImage();
    };
  </script>
</body>
</html>
